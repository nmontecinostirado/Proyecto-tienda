<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>Tienda demo - Frontend (Bootstrap 4 + JS)</title>

  <!-- Bootstrap 4 CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" crossorigin="anonymous">

  <style>
    body { padding-top: 70px; }
    .product-card img { height: 180px; object-fit: cover; }
    .cursor-pointer { cursor: pointer; }
    .badge-cart { position: absolute; top: 0.6rem; right: 0.6rem; }
  </style>
</head>
<body>

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
    <a class="navbar-brand" href="#" data-view="home">Tienda Demo</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarsExampleDefault">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="#" data-view="home">Inicio</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-view="products">Productos</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-view="about">Acerca</a>
        </li>
      </ul>
      <ul class="navbar-nav">
        <li class="nav-item position-relative">
          <a class="nav-link" href="#" id="cart-link" data-view="cart">
            ðŸ›’ Carro <span id="cart-count" class="badge badge-pill badge-danger badge-cart">0</span>
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- MAIN CONTAINER (views are swapped via JS) -->
  <main class="container" id="app">

    <!-- HOME VIEW -->
    <section id="view-home" class="view">
      <div class="jumbotron">
        <h1 class="display-4">Bienvenido a la Tienda Demo</h1>
        <p class="lead">Frontend de una tienda de e-commerce construido con <strong>Bootstrap 4</strong> y JavaScript puro.</p>
        <hr class="my-4">
        <p>Explora los productos, ve los detalles y usa el carrito de compras.</p>
        <a class="btn btn-primary btn-lg" href="#" role="button" data-view="products">Ver productos</a>
      </div>
    </section>

    <!-- PRODUCTS LIST VIEW -->
    <section id="view-products" class="view d-none">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Productos</h2>
        <input id="search-input" class="form-control w-50" placeholder="Buscar producto..." />
      </div>

      <div id="products-row" class="row"></div>
    </section>

    <!-- PRODUCT DETAIL VIEW -->
    <section id="view-product" class="view d-none">
      <div class="row">
        <div class="col-md-6">
          <img id="prod-image" src="" alt="" class="img-fluid" />
        </div>
        <div class="col-md-6">
          <h2 id="prod-title"></h2>
          <p id="prod-short" class="text-muted"></p>
          <h3 id="prod-price"></h3>
          <p id="prod-description"></p>
          <div class="form-group w-25">
            <label for="qty">Cantidad</label>
            <input type="number" id="qty" class="form-control" value="1" min="1" />
          </div>
          <button id="add-to-cart" class="btn btn-success">Agregar al carrito</button>
          <a href="#" class="btn btn-link" data-view="products">Volver a productos</a>
        </div>
      </div>
    </section>

    <!-- CART VIEW -->
    <section id="view-cart" class="view d-none">
      <h2>Carro de compras</h2>
      <div id="cart-container"></div>
      <div class="mt-3">
        <button id="checkout-btn" class="btn btn-primary">Proceder al pago (simulado)</button>
        <a href="#" class="btn btn-link" data-view="products">Seguir comprando</a>
      </div>
    </section>

    <!-- ABOUT VIEW -->
    <section id="view-about" class="view d-none">
      <h2>Acerca de la tienda</h2>
      <p>Esta es una tienda demo creada para fines educativos. No realiza transacciones reales.</p>
    </section>

  </main>

  <!-- FOOTER -->
  <footer class="bg-light text-center text-md-left mt-5 py-4">
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <h6 class="text-uppercase font-weight-bold">Tienda Demo</h6>
          <p>DirecciÃ³n: Calle Falsa 123, Ciudad Santiago de chile</p>
          <p>Contacto: ejemplo@tienda.com | +56 9 1234 5678</p>
        </div>
        <div class="col-md-6 text-md-right">
          <h6 class="text-uppercase font-weight-bold">SÃ­guenos</h6>
          <a href="#">Facebook</a> â€¢ <a href="#">Twitter</a> â€¢ <a href="#">Instagram</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- PRODUCT MODAL (muestra imagen grande y descripciÃ³n) -->
  <div class="modal fade" id="productModal" tabindex="-1" role="dialog" aria-labelledby="productModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 id="modal-title" class="modal-title"></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-6 text-center">
              <img id="modal-image" src="" alt="" class="img-fluid" style="max-height:400px; object-fit:contain;" />
            </div>
            <div class="col-md-6">
              <h4 id="modal-price"></h4>
              <p id="modal-short" class="text-muted"></p>
              <p id="modal-description"></p>
              <div class="form-group w-50">
                <label for="modal-qty">Cantidad</label>
                <input type="number" id="modal-qty" class="form-control" value="1" min="1" />
              </div>
              <button id="modal-add-to-cart" class="btn btn-success">Agregar al carrito</button>
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Required Bootstrap JS (jQuery, Popper, Bootstrap) - deben cargarse antes del script que usa el modal -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" crossorigin="anonymous"></script>

  <!-- Sample products data and JS -->
  <script>
    // --- PRODUCTS: CORREGIDO ---
    // Ajusta las rutas de imagen si es necesario
    const PRODUCTS = [
      {
        id: 'p1',
        title: 'Zapatillas Runner X',
        price: 79000,
        short: 'CÃ³modas zapatillas para uso diario',
        description: 'Zapatillas Runner X con suela flexible, diseÃ±o transpirable y soporte para todo el dÃ­a. Disponibles en varios colores.',
        image: 'css/assets/zapatilla.webp'
      },
      {
        id: 'p2',
        title: 'Auriculares BeatPro',
        price: 59000,
        short: 'Auriculares con cancelaciÃ³n de ruido',
        description: 'Auriculares BeatPro con micrÃ³fono integrado, baterÃ­a de larga duraciÃ³n y diseÃ±o ergonÃ³mico.',
        image: 'css/assets/audifonos.webp'
      },
      {
        id: 'p3',
        title: 'Mochila UrbanPack',
        price: 45000,
        short: 'Mochila resistente e impermeable',
        description: 'Mochila UrbanPack ideal para la ciudad y viajes cortos, con mÃºltiples compartimentos y puerto USB integrado.',
        image: 'css/assets/mochila.webp'
      }
    ];

    // Estado simple: view y cart
    let state = {
      view: 'home', // home, products, product, cart, about
      currentProduct: null,
      cart: JSON.parse(localStorage.getItem('cart') || '[]')
    };

    // ---------- Helpers ----------
    function $(sel) { return document.querySelector(sel); }
    function $all(sel) { return Array.from(document.querySelectorAll(sel)); }

    function saveCart() {
      localStorage.setItem('cart', JSON.stringify(state.cart));
      renderCartCount();
    }

    // Formato de precio para CLP
    const moneyFmt = new Intl.NumberFormat('es-CL', { style: 'currency', currency: 'CLP', maximumFractionDigits: 0 });
    function formatPrice(p) { return moneyFmt.format(p); }

    // ---------- Rendering ----------
    function renderView() {
      $all('.view').forEach(s => s.classList.add('d-none'));
      const id = 'view-' + state.view;
      const el = document.getElementById(id);
      if (el) el.classList.remove('d-none');

      if (state.view === 'products') renderProducts();
      if (state.view === 'product') renderProductDetail();
      if (state.view === 'cart') renderCart();
    }

    function renderProducts(filter = '') {
      const row = $('#products-row');
      if (!row) return;
      row.innerHTML = '';
      const q = filter.trim().toLowerCase();
      const list = PRODUCTS.filter(p => p.title.toLowerCase().includes(q) || p.short.toLowerCase().includes(q));
      list.forEach(p => {
        const col = document.createElement('div');
        col.className = 'col-md-4 mb-4';
        col.innerHTML = `
          <div class="card product-card h-100">
            <img src="${p.image}" class="card-img-top" alt="${p.title}">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">${p.title}</h5>
              <p class="card-text text-muted">${p.short}</p>
              <div class="mt-auto">
                <p class="h5">${formatPrice(p.price)}</p>
                <button class="btn btn-primary btn-sm btn-block mb-2" data-action="view" data-id="${p.id}">Ver producto</button>
                <button class="btn btn-outline-secondary btn-sm btn-block mb-2" data-action="details" data-id="${p.id}">Ver detalles</button>
                <button class="btn btn-success btn-sm btn-block" data-action="add" data-id="${p.id}">Comprar</button>
              </div>
            </div>
          </div>
        `;
        row.appendChild(col);
      });

      if (list.length === 0) {
        row.innerHTML = '<div class="col-12"><p>No se encontraron productos.</p></div>';
      }
    }

    function renderProductDetail() {
      const p = PRODUCTS.find(x => x.id === state.currentProduct);
      if (!p) return;
      const img = $('#prod-image');
      if (img) {
        img.src = p.image;
        img.alt = p.title;
      }
      $('#prod-title').textContent = p.title;
      $('#prod-short').textContent = p.short;
      $('#prod-price').textContent = formatPrice(p.price);
      $('#prod-description').textContent = p.description;
      const qty = $('#qty');
      if (qty) qty.value = 1;
    }

    function renderCartCount() {
      const countEl = $('#cart-count');
      if (!countEl) return;
      const count = state.cart.reduce((s, it) => s + it.qty, 0);
      countEl.textContent = count;
    }

    function renderCart() {
      const container = $('#cart-container');
      if (!container) return;
      if (state.cart.length === 0) {
        container.innerHTML = '<p>Tu carrito estÃ¡ vacÃ­o. <a href="#" data-view="products">Ir a productos</a></p>';
        return;
      }
      let html = '<div class="table-responsive"><table class="table"><thead><tr><th>Producto</th><th>Precio</th><th>Cantidad</th><th>Subtotal</th><th></th></tr></thead><tbody>';
      let total = 0;
      state.cart.forEach(item => {
        const p = PRODUCTS.find(x => x.id === item.id);
        const subtotal = p.price * item.qty;
        total += subtotal;
        html += `<tr>
          <td>${p.title}</td>
          <td>${formatPrice(p.price)}</td>
          <td><input type="number" class="form-control qty-input" data-id="${item.id}" value="${item.qty}" min="1" style="width:80px"/></td>
          <td>${formatPrice(subtotal)}</td>
          <td><button class="btn btn-sm btn-danger remove-item" data-id="${item.id}">Eliminar</button></td>
        </tr>`;
      });
      html += `</tbody></table></div>
        <div class="text-right"><h4>Total: ${formatPrice(total)}</h4></div>`;
      container.innerHTML = html;

      // attach listeners for qty inputs and remove buttons
      $all('.qty-input').forEach(inp => {
        inp.addEventListener('change', (e) => {
          const id = e.target.dataset.id;
          const val = Math.max(1, parseInt(e.target.value, 10) || 1);
          const it = state.cart.find(i => i.id === id);
          if (it) { it.qty = val; saveCart(); renderCart(); }
        });
      });

      $all('.remove-item').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const id = e.target.dataset.id;
          state.cart = state.cart.filter(i => i.id !== id);
          saveCart(); renderCart();
        });
      });
    }

    // ---------- Actions ----------
    function addToCart(id, qty = 1) {
      const existing = state.cart.find(i => i.id === id);
      if (existing) existing.qty += qty;
      else state.cart.push({ id, qty });
      saveCart();
      // actualizar contador en barra (saveCart ya lo hace)
      // Mensaje simple:
      // alert('Producto agregado al carrito'); // opcional
    }

    function routeTo(view, opts) {
      state.view = view;
      if (view === 'product' && opts && opts.id) state.currentProduct = opts.id;
      renderView();
    }

    // Muestra modal poblado con producto (imagen grande + descripciÃ³n)
    function showProductModal(id) {
      const p = PRODUCTS.find(x => x.id === id);
      if (!p) return;
      $('#modal-title').text(p.title);
      $('#modal-image').attr('src', p.image).attr('alt', p.title);
      $('#modal-price').text(formatPrice(p.price));
      $('#modal-short').text(p.short);
      $('#modal-description').text(p.description);
      $('#modal-qty').val(1);
      // almacenar ID actual del modal en dataset para usar al agregar al carrito
      $('#productModal').data('product-id', id);
      $('#productModal').modal('show');
    }

    // ---------- Event delegation ----------
    document.addEventListener('click', (e) => {
      const targetView = e.target.closest('[data-view]');
      if (targetView) {
        e.preventDefault();
        const view = targetView.dataset.view;
        routeTo(view);
        return;
      }

      const act = e.target.closest('[data-action]');
      if (act) {
        const action = act.dataset.action;
        const id = act.dataset.id;
        if (action === 'view') {
          // Abrir modal con imagen grande y descripciÃ³n
          showProductModal(id);
        } else if (action === 'details') {
          // Ir a la vista de detalle completa
          routeTo('product', { id });
        } else if (action === 'add') {
          addToCart(id, 1);
        }
        return;
      }

      // BotÃ³n en detalle de producto (vista product)
      if (e.target && e.target.id === 'add-to-cart') {
        const id = state.currentProduct;
        const qty = parseInt($('#qty').val(), 10) || 1;
        addToCart(id, qty);
      }
    });

    // Listener para agregar desde el modal
    document.getElementById('modal-add-to-cart').addEventListener('click', function () {
      const modal = $('#productModal');
      const id = modal.data('product-id');
      const qty = parseInt($('#modal-qty').val(), 10) || 1;
      addToCart(id, qty);
      modal.modal('hide');
    });

    // Search - verifica existencia del input antes de aÃ±adir listener
    const searchInput = $('#search-input');
    if (searchInput) {
      searchInput.addEventListener('input', (e) => {
        renderProducts(e.target.value);
      });
    }

    // Checkout (simulado)
    const checkoutBtn = $('#checkout-btn');
    if (checkoutBtn) {
      checkoutBtn.addEventListener('click', () => {
        if (state.cart.length === 0) { alert('El carrito estÃ¡ vacÃ­o'); return; }
        alert('Compra simulada realizada. Â¡Gracias por tu compra!');
        state.cart = [];
        saveCart();
        routeTo('home');
      });
    }

    // Initialize
    function init() {
      renderView();
      renderCartCount();
      renderProducts();

      if (location.hash) {
        const h = location.hash.replace('#', '');
        if (h === 'products') routeTo('products');
      }
    }

    init();
  </script>

</body>
</html>

